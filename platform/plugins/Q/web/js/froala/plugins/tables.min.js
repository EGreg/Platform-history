/*!
 * froala_editor v1.1.6 (http://editor.froala.com)
 * Copyright 2014-2014 Froala
 */
$.Editable.commands=$.extend($.Editable.commands,{table:{title:"Table",icon:"fa fa-table"}}),$.Editable.DEFAULTS.buttons[$.Editable.DEFAULTS.buttons.indexOf("insertHorizontalRule")]="table",$.Editable.prototype.execCommand=$.extend($.Editable.prototype.execCommand,{insertTable:function(a,b,c){this.insertTable(b,c)},insertRowAbove:function(){this.insertRow("above")},insertRowBelow:function(){this.insertRow("below")},insertColumnBefore:function(){this.insertColumn("before")},insertColumnAfter:function(){this.insertColumn("after")},deleteColumn:function(){this.deleteColumn()},deleteRow:function(){this.deleteRow()},insertCellBefore:function(){this.insertCell("before")},insertCellAfter:function(){this.insertCell("after")},mergeCells:function(){this.mergeCells()},deleteCell:function(){this.deleteCell()},splitVertical:function(){this.splitVertical()},splitHorizontal:function(){this.splitHorizontal()},insertHeader:function(){this.insertHeader()},deleteHeader:function(){this.deleteHeader()},deleteTable:function(){this.deleteTable()}}),$.Editable.prototype.command_dispatcher=$.extend($.Editable.prototype.command_dispatcher,{table:function(a){var b=this.buildDropdownTable(),c=this.buildDropdownButton(a,b,"fr-table");this.$bttn_wrapper.append(c),this.bindTableDropdownEvents()}}),$.Editable.prototype.buildDropdownTable=function(){var a='<ul class="fr-dropdown-menu fr-table">';a+='<li>     <a href="#"><span data-text="true">Insert table</span> <i class="fa fa-chevron-right"></i></a>    <div class="select-table"> ',a+='<div class="fr-t-info">1 x 1</div>';for(var b=1;10>=b;b++){for(var c=1;10>=c;c++){var d="inline-block";(b>5||c>5)&&(d="none");var e="fr-bttn ";1==b&&1==c&&(e+=" hover"),a+='<span class="'+e+'" data-cmd="insertTable" data-val="'+b+'" data-param="'+c+'" style="display: '+d+';"><span></span></span>'}a+='<div class="new-line"></div>'}return a+="</div>     </li>",a+='<li><a href="#"><span data-text="true">Cell</span> <i class="fa fa-chevron-right"></i></a>     <ul>       <li data-cmd="insertCellBefore"><a href="#" data-text="true">Insert cell before</a></li>       <li data-cmd="insertCellAfter"><a href="#" data-text="true">Insert cell after</a></li>       <li data-cmd="deleteCell"><a href="#" data-text="true">Delete cell</a></li>       <li data-cmd="mergeCells"><a href="#" data-text="true">Merge cells</a></li>       <li data-cmd="splitHorizontal"><a href="#" data-text="true">Horizontal split</a></li>       <li data-cmd="splitVertical"><a href="#" data-text="true">Vertical split</a></li>     </ul></li>',a+='<li><a href="#"><span data-text="true">Row</span> <i class="fa fa-chevron-right"></i></a>     <ul>       <li data-cmd="insertRowAbove"><a href="#" data-text="true">Insert row above</a></li>       <li data-cmd="insertRowBelow"><a href="#" data-text="true">Insert row below</a></li>       <li data-cmd="deleteRow"><a href="#" data-text="true">Delete row</a></li>     </ul></li>',a+='<li><a href="#"><span data-text="true">Column</span> <i class="fa fa-chevron-right"></i></a>     <ul>       <li data-cmd="insertColumnBefore"><a href="#" data-text="true">Insert column before</a></li>       <li data-cmd="insertColumnAfter"><a href="#" data-text="true">Insert column after</a></li>       <li data-cmd="deleteColumn"><a href="#" data-text="true">Delete column</a></li>     </ul></li>',a+='<li data-cmd="deleteTable"><a href="#" data-text="true">Delete table</a></li>',a+="</ul>"},$.Editable.prototype.bindTableDropdownEvents=function(){var a=this;this.$bttn_wrapper.on("mouseenter",".fr-table .select-table > span",function(){var b=$(this).data("val"),c=$(this).data("param");a.$bttn_wrapper.find(".fr-table .select-table .fr-t-info").text(b+" x "+c),a.$bttn_wrapper.find(".fr-table .select-table > span").removeClass("hover");for(var d=1;10>=d;d++)for(var e=0;10>=e;e++){var f=a.$bttn_wrapper.find('.fr-table .select-table > span[data-val="'+d+'"][data-param="'+e+'"]');b>=d&&c>=e?f.addClass("hover"):(b+1>=d||5>=d)&&(c+1>=e||5>=e)?f.css("display","inline-block"):(d>5||e>5)&&f.css("display","none")}}),this.$bttn_wrapper.on("mouseleave",".fr-table .select-table",function(){a.$bttn_wrapper.find('.fr-table .select-table > span[data-val="1"][data-param="1"]').trigger("mouseenter")})},$.Editable.prototype.tableMap=function(){var a=this.currentTable(),b=[];return a&&a.find("tr").each(function(a,c){var d=$(c),e=0;d.find("td").each(function(c,d){for(var f=$(d),g=parseInt(f.attr("colspan"))||1,h=parseInt(f.attr("rowspan"))||1,i=a;a+h>i;i++)for(var j=e;e+g>j;j++)b[i]||(b[i]=[]),b[i][j]?e++:b[i][j]=d;e+=g})}),b},$.Editable.prototype.cellOrigin=function(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++)if(b[c][d]==a)return{row:c,col:d}},$.Editable.prototype.canMergeCells=function(){var a=this.getSelectionCells();if(a.length<2)return!1;for(var b=this.tableMap(),c=0,d=32e3,e=0,f=32e3,g=0,h=0;h<a.length;h++){var i=$(a[h]),j=parseInt(i.attr("colspan"))||1,k=parseInt(i.attr("rowspan"))||1,l=this.cellOrigin(a[h],b);c+=j*k,d=Math.min(d,l.col),e=Math.max(e,l.col+j),f=Math.min(f,l.row),g=Math.max(g,l.row+k)}return c==(e-d)*(g-f)?{row:f,col:d,colspan:e-d,rowspan:g-f,map:b,cells:a}:null},$.Editable.prototype.currentCell=function(){var a=this.getSelectionCells();return a.length>0?a[0]:null},$.Editable.prototype.currentTable=function(){for(var a=$(this.getSelectionElement());a.get(0)!=this.$element.get(0)&&a.get(0)!=$("body").get(0)&&"TABLE"!=a.get(0).tagName;)a=a.parent();return a.get(0)!=this.$element.get(0)?a:null},$.Editable.prototype.focusOnTable=function(){var a=this.currentTable();if(a){var b=a.find("td:first");this.setSelection(b.get(0),0,null,0)}},$.Editable.prototype.insertCell=function(a){for(var b=this.getSelectionCells(),c=0;c<b.length;c++){var d=$(b[c]);"before"==a?d.before(d.clone().removeAttr("colspan").removeAttr("rowspan").html("<br/>")):"after"==a&&d.after(d.clone().removeAttr("colspan").removeAttr("rowspan").html("<br/>"))}"before"==a?this.callback("insertCellBefore"):"after"==a&&this.callback("insertCellAfter")},$.Editable.prototype.mergeCells=function(){var a=this.canMergeCells();if(a){var b=$(a.map[a.row][a.col]);b.attr("colspan",a.colspan),b.attr("rowspan",a.rowspan);for(var c=0;c<a.cells.length;c++){var d=a.cells[c];if(b.get(0)!=d){var e=$(d);b.append(e.html()),e.remove()}}this.setSelection(b.get(0),0,null,0)}this.callback("mergeCells")},$.Editable.prototype.deleteCell=function(){for(var a=this.getSelectionCells(),b=0;b<a.length;b++){var c=$(a[b]);c.remove()}this.focusOnTable(),this.callback("deleteCell")},$.Editable.prototype.insertHeader=function(){var a=this.currentTable();a&&a.find(" > thead").length>0&&this.callback("insertHeader")},$.Editable.prototype.deleteHeader=function(){},$.Editable.prototype.insertColumn=function(a){var b=this.currentCell();if(b)for(var c=$(b),d=this.tableMap(),e=this.cellOrigin(c.get(0),d),f=0;f<d.length;f++){var g=d[f][e.col],h=parseInt($(g).attr("colspan"))||1,i=parseInt($(g).attr("rowspan"))||1;if("before"==a){var j=d[f][e.col-1];j?j==g?$(j).attr("colspan",h+1):i>1?$(j).after("<td><br/></td>"):$(g).before("<td><br/></td>"):$(g).before("<td><br/></td>")}else if("after"==a){var k=d[f][e.col+1];k?k==g?$(k).attr("colspan",h+1):i>1?$(k).before("<td><br/></td>"):$(g).after("<td><br/></td>"):$(g).after("<td><br/></td>")}}"before"==a?this.callback("insertColumnBefore"):"after"==a&&this.callback("insertColumnAfter")},$.Editable.prototype.deleteColumn=function(){for(var a=this.getSelectionCells(),b=0;b<a.length;b++)for(var c=$(a[b]),d=this.tableMap(),e=this.cellOrigin(c.get(0),d),f=0;f<d.length;f++){{var g=d[f][e.col],h=parseInt($(g).attr("colspan"))||1;parseInt($(g).attr("rowspan"))||1}if(1==h)$(g).remove();else{{this.cellOrigin(g,d)}$(g).attr("colspan",h-1)}}this.focusOnTable(),this.callback("deleteColumn")},$.Editable.prototype.insertRow=function(a){var b=this.currentCell();if(b){for(var c=$(b),d=this.tableMap(),e=this.cellOrigin(c.get(0),d),f=0,g=null,h=0;h<d[e.row].length;h++){var i=d[e.row][h],j=(parseInt($(i).attr("colspan"))||1,parseInt($(i).attr("rowspan"))||1);if("above"==a)if(0==e.row)f++;else{var k=d[e.row-1][h];k==i&&g!=i?$(i).attr("rowspan",j+1):f++}else if("below"==a)if(e.row==d.length-1)f++;else{var l=d[e.row+1][h];l==i&&g!=i?$(i).attr("rowspan",j+1):f++}g=d[e.row][h]}for(var m="<tr>",h=0;f>h;h++)m+="<td><br/></td>";m+="</tr>","below"==a?c.closest("tr").after(m):"above"==a&&c.closest("tr").before(m)}"below"==a?this.callback("insertRowBelow"):"above"==a&&this.callback("insertRowAbove")},$.Editable.prototype.deleteRow=function(){for(var a=this.getSelectionCells(),b=0;b<a.length;b++){for(var c=$(a[b]),d=this.tableMap(),e=this.cellOrigin(c.get(0),d),f=c.parents("tr:first"),g=0;g<d[e.row].length;g++){var h=d[e.row][g],i=(parseInt($(h).attr("colspan"))||1,parseInt($(h).attr("rowspan"))||1);if(1==i)$(h).remove();else{var j=this.cellOrigin(h,d);if($(h).attr("rowspan",i-1),j.row==e.row){var k=d[e.row+1];k&&k[g-1]&&($(k[g-1]).after($(h).clone()),$(h).remove())}}}f.remove()}this.focusOnTable(),this.callback("deleteRow")},$.Editable.prototype.splitVertical=function(){for(var a=this.getSelectionCells(),b=0;b<a.length;b++){var c=$(a[b]),d=this.tableMap(),e=this.cellOrigin(c.get(0),d),f=parseInt(c.attr("colspan"))||1,g=parseInt(c.attr("rowspan"))||1;if(g>1){var h=Math.floor(g/2),i=e.row+(g-h),j=d[i][e.col-1];j||(j=d[i][e.col+f]),j?$(j).before(c.clone().attr("rowspan",h).html("<br/>")):c.parents("tr:first").after($("<tr>").append(c.clone().attr("rowspan",h).html("<br/>"))),c.attr("rowspan",g-h)}else{for(var k=$("<tr>").append(c.clone().html("<br/>")),l=null,m=0;m<d[e.row].length;m++){var n=d[e.row][m],o=parseInt($(n).attr("rowspan"))||1;l!=n&&n!=c.get(0)&&$(n).attr("rowspan",o+1),l=n}c.parents("tr:first").after(k)}}this.callback("splitHorizontal")},$.Editable.prototype.splitHorizontal=function(){for(var a=this.getSelectionCells(),b=0;b<a.length;b++){{var c=$(a[b]),d=this.tableMap(),e=this.cellOrigin(c.get(0),d),f=parseInt(c.attr("colspan"))||1;parseInt(c.attr("rowspan"))||1}if(f>1){var g=Math.floor(f/2);c.after(c.clone().attr("colspan",g).html("<br/>")),c.attr("colspan",f-g)}else{for(var h=null,i=0;i<d.length;i++){var j=d[i][e.col],k=parseInt($(j).attr("colspan"))||1;h!=j&&j!=c.get(0)&&$(j).attr("colspan",k+1),h=j}c.after(c.clone().html("<br/>"))}}this.callback("splitVertical")},$.Editable.prototype.insertTable=function(a,b){for(var c='<table class="f-t-l" width="100%">',d=0;a>d;d++){c+="<tr>";for(var e=0;b>e;e++)c+="<td><br/></td>";c+="</tr>"}c+="</table>",this.insertHTML(c);var f=this.$element.find("table.f-t-l");f.removeClass("f-t-l"),this.setSelection(f.find("td:first").get(0),0,null,0),this.$element.focus(),this.callback("insertTable")},$.Editable.prototype.deleteTable=function(){var a=this.currentTable();a&&(a.remove(),this.callback("deleteTable"))};